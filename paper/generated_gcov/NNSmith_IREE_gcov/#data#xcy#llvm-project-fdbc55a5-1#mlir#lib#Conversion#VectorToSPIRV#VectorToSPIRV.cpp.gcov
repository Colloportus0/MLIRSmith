        -:    0:Source:/data/xcy/llvm-project-fdbc55a5-1/mlir/lib/Conversion/VectorToSPIRV/VectorToSPIRV.cpp
        -:    0:Graph:../tools/mlir/lib/Conversion/VectorToSPIRV/CMakeFiles/obj.MLIRVectorToSPIRV.dir/VectorToSPIRV.cpp.gcno
        -:    0:Data:../tools/mlir/lib/Conversion/VectorToSPIRV/CMakeFiles/obj.MLIRVectorToSPIRV.dir/VectorToSPIRV.cpp.gcda
        -:    0:Runs:325560
        -:    1://===- VectorToSPIRV.cpp - Vector to SPIR-V Patterns ----------------------===//
        -:    2://
        -:    3:// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
        -:    4:// See https://llvm.org/LICENSE.txt for license information.
        -:    5:// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
        -:    6://
        -:    7://===----------------------------------------------------------------------===//
        -:    8://
        -:    9:// This file implements patterns to convert Vector dialect to SPIRV dialect.
        -:   10://
        -:   11://===----------------------------------------------------------------------===//
        -:   12:
        -:   13:#include "mlir/Conversion/VectorToSPIRV/VectorToSPIRV.h"
        -:   14:
        -:   15:#include "mlir/Dialect/SPIRV/IR/SPIRVDialect.h"
        -:   16:#include "mlir/Dialect/SPIRV/IR/SPIRVOps.h"
        -:   17:#include "mlir/Dialect/SPIRV/IR/SPIRVTypes.h"
        -:   18:#include "mlir/Dialect/SPIRV/Transforms/SPIRVConversion.h"
        -:   19:#include "mlir/Dialect/Vector/IR/VectorOps.h"
        -:   20:#include "mlir/IR/BuiltinAttributes.h"
        -:   21:#include "mlir/IR/BuiltinTypes.h"
        -:   22:#include "mlir/Transforms/DialectConversion.h"
        -:   23:#include "llvm/ADT/ArrayRef.h"
        -:   24:#include "llvm/ADT/STLExtras.h"
        -:   25:#include <numeric>
        -:   26:
        -:   27:using namespace mlir;
        -:   28:
        -:   29:/// Gets the first integer value from `attr`, assuming it is an integer array
        -:   30:/// attribute.
function _ZL16getFirstIntValueN4mlir9ArrayAttrE called 0 returned 0% blocks executed 0%
    #####:   31:static uint64_t getFirstIntValue(ArrayAttr attr) {
    #####:   32:  return (*attr.getAsValueRange<IntegerAttr>().begin()).getZExtValue();
call    0 never executed
call    1 never executed
call    2 never executed
branch  3 never executed
branch  4 never executed
        -:   33:}
        -:   34:
        -:   35:namespace {
        -:   36:
        -:   37:struct VectorBitcastConvert final
        -:   38:    : public OpConversionPattern<vector::BitCastOp> {
        -:   39:  using OpConversionPattern::OpConversionPattern;
        -:   40:
        -:   41:  LogicalResult
function _ZNK12_GLOBAL__N_120VectorBitcastConvert15matchAndRewriteEN4mlir6vector9BitCastOpENS2_16BitCastOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:   42:  matchAndRewrite(vector::BitCastOp bitcastOp, OpAdaptor adaptor,
        -:   43:                  ConversionPatternRewriter &rewriter) const override {
    #####:   44:    Type dstType = getTypeConverter()->convertType(bitcastOp.getType());
call    0 never executed
call    1 never executed
    #####:   45:    if (!dstType)
branch  0 never executed
branch  1 never executed
    #####:   46:      return failure();
        -:   47:
    #####:   48:    if (dstType == adaptor.getSource().getType())
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:   49:      rewriter.replaceOp(bitcastOp, adaptor.getSource());
call    0 never executed
call    1 never executed
call    2 never executed
        -:   50:    else
    #####:   51:      rewriter.replaceOpWithNewOp<spirv::BitcastOp>(bitcastOp, dstType,
    #####:   52:                                                    adaptor.getSource());
call    0 never executed
call    1 never executed
        -:   53:
    #####:   54:    return success();
        -:   55:  }
        -:   56:};
        -:   57:
        -:   58:struct VectorBroadcastConvert final
        -:   59:    : public OpConversionPattern<vector::BroadcastOp> {
        -:   60:  using OpConversionPattern::OpConversionPattern;
        -:   61:
        -:   62:  LogicalResult
function _ZNK12_GLOBAL__N_122VectorBroadcastConvert15matchAndRewriteEN4mlir6vector11BroadcastOpENS2_18BroadcastOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:   63:  matchAndRewrite(vector::BroadcastOp castOp, OpAdaptor adaptor,
        -:   64:                  ConversionPatternRewriter &rewriter) const override {
    #####:   65:    Type resultType = getTypeConverter()->convertType(castOp.getVectorType());
call    0 never executed
call    1 never executed
    #####:   66:    if (!resultType)
branch  0 never executed
branch  1 never executed
    #####:   67:      return failure();
        -:   68:
    #####:   69:    if (resultType.isa<spirv::ScalarType>()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:   70:      rewriter.replaceOp(castOp, adaptor.getSource());
call    0 never executed
call    1 never executed
call    2 never executed
    #####:   71:      return success();
        -:   72:    }
        -:   73:
    #####:   74:    SmallVector<Value, 4> source(castOp.getVectorType().getNumElements(),
call    0 never executed
call    1 never executed
    #####:   75:                                 adaptor.getSource());
call    0 never executed
call    1 never executed
    #####:   76:    rewriter.replaceOpWithNewOp<spirv::CompositeConstructOp>(
    #####:   77:        castOp, castOp.getVectorType(), source);
call    0 never executed
call    1 never executed
    #####:   78:    return success();
branch  0 never executed
branch  1 never executed
        -:   79:  }
        -:   80:};
        -:   81:
        -:   82:struct VectorExtractOpConvert final
        -:   83:    : public OpConversionPattern<vector::ExtractOp> {
        -:   84:  using OpConversionPattern::OpConversionPattern;
        -:   85:
        -:   86:  LogicalResult
function _ZNK12_GLOBAL__N_122VectorExtractOpConvert15matchAndRewriteEN4mlir6vector9ExtractOpENS2_16ExtractOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:   87:  matchAndRewrite(vector::ExtractOp extractOp, OpAdaptor adaptor,
        -:   88:                  ConversionPatternRewriter &rewriter) const override {
        -:   89:    // Only support extracting a scalar value now.
    #####:   90:    VectorType resultVectorType = extractOp.getType().dyn_cast<VectorType>();
call    0 never executed
    #####:   91:    if (resultVectorType && resultVectorType.getNumElements() > 1)
branch  0 never executed
branch  1 never executed
call    2 never executed
branch  3 never executed
branch  4 never executed
    #####:   92:      return failure();
        -:   93:
    #####:   94:    Type dstType = getTypeConverter()->convertType(extractOp.getType());
call    0 never executed
    #####:   95:    if (!dstType)
branch  0 never executed
branch  1 never executed
    #####:   96:      return failure();
        -:   97:
    #####:   98:    if (adaptor.getVector().getType().isa<spirv::ScalarType>()) {
call    0 never executed
call    1 never executed
branch  2 never executed
branch  3 never executed
    #####:   99:      rewriter.replaceOp(extractOp, adaptor.getVector());
call    0 never executed
call    1 never executed
call    2 never executed
    #####:  100:      return success();
        -:  101:    }
        -:  102:
    #####:  103:    int32_t id = getFirstIntValue(extractOp.getPosition());
call    0 never executed
call    1 never executed
    #####:  104:    rewriter.replaceOpWithNewOp<spirv::CompositeExtractOp>(
    #####:  105:        extractOp, adaptor.getVector(), id);
call    0 never executed
call    1 never executed
    #####:  106:    return success();
        -:  107:  }
        -:  108:};
        -:  109:
        -:  110:struct VectorExtractStridedSliceOpConvert final
        -:  111:    : public OpConversionPattern<vector::ExtractStridedSliceOp> {
        -:  112:  using OpConversionPattern::OpConversionPattern;
        -:  113:
        -:  114:  LogicalResult
function _ZNK12_GLOBAL__N_134VectorExtractStridedSliceOpConvert15matchAndRewriteEN4mlir6vector21ExtractStridedSliceOpENS2_28ExtractStridedSliceOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  115:  matchAndRewrite(vector::ExtractStridedSliceOp extractOp, OpAdaptor adaptor,
        -:  116:                  ConversionPatternRewriter &rewriter) const override {
    #####:  117:    Type dstType = getTypeConverter()->convertType(extractOp.getType());
call    0 never executed
call    1 never executed
    #####:  118:    if (!dstType)
branch  0 never executed
branch  1 never executed
    #####:  119:      return failure();
        -:  120:
    #####:  121:    uint64_t offset = getFirstIntValue(extractOp.getOffsets());
call    0 never executed
call    1 never executed
    #####:  122:    uint64_t size = getFirstIntValue(extractOp.getSizes());
call    0 never executed
call    1 never executed
    #####:  123:    uint64_t stride = getFirstIntValue(extractOp.getStrides());
call    0 never executed
call    1 never executed
    #####:  124:    if (stride != 1)
branch  0 never executed
branch  1 never executed
    #####:  125:      return failure();
        -:  126:
    #####:  127:    Value srcVector = adaptor.getOperands().front();
call    0 never executed
call    1 never executed
        -:  128:
        -:  129:    // Extract vector<1xT> case.
    #####:  130:    if (dstType.isa<spirv::ScalarType>()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  131:      rewriter.replaceOpWithNewOp<spirv::CompositeExtractOp>(extractOp,
    #####:  132:                                                             srcVector, offset);
call    0 never executed
    #####:  133:      return success();
        -:  134:    }
        -:  135:
    #####:  136:    SmallVector<int32_t, 2> indices(size);
call    0 never executed
    #####:  137:    std::iota(indices.begin(), indices.end(), offset);
        -:  138:
    #####:  139:    rewriter.replaceOpWithNewOp<spirv::VectorShuffleOp>(
        -:  140:        extractOp, dstType, srcVector, srcVector,
    #####:  141:        rewriter.getI32ArrayAttr(indices));
call    0 never executed
call    1 never executed
        -:  142:
    #####:  143:    return success();
branch  0 never executed
branch  1 never executed
        -:  144:  }
        -:  145:};
        -:  146:
        -:  147:template <class SPIRVFMAOp>
        -:  148:struct VectorFmaOpConvert final : public OpConversionPattern<vector::FMAOp> {
        -:  149:  using OpConversionPattern::OpConversionPattern;
        -:  150:
        -:  151:  LogicalResult
    #####:  152:  matchAndRewrite(vector::FMAOp fmaOp, OpAdaptor adaptor,
        -:  153:                  ConversionPatternRewriter &rewriter) const override {
    #####:  154:    Type dstType = getTypeConverter()->convertType(fmaOp.getType());
    #####:  155:    if (!dstType)
    #####:  156:      return failure();
    #####:  157:    rewriter.replaceOpWithNewOp<SPIRVFMAOp>(fmaOp, dstType, adaptor.getLhs(),
    #####:  158:                                            adaptor.getRhs(), adaptor.getAcc());
    #####:  159:    return success();
        -:  160:  }
------------------
_ZNK12_GLOBAL__N_118VectorFmaOpConvertIN4mlir5spirv7GLFmaOpEE15matchAndRewriteENS1_6vector5FMAOpENS5_12FMAOpAdaptorERNS1_25ConversionPatternRewriterE:
function _ZNK12_GLOBAL__N_118VectorFmaOpConvertIN4mlir5spirv7GLFmaOpEE15matchAndRewriteENS1_6vector5FMAOpENS5_12FMAOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  152:  matchAndRewrite(vector::FMAOp fmaOp, OpAdaptor adaptor,
        -:  153:                  ConversionPatternRewriter &rewriter) const override {
    #####:  154:    Type dstType = getTypeConverter()->convertType(fmaOp.getType());
call    0 never executed
call    1 never executed
    #####:  155:    if (!dstType)
branch  0 never executed
branch  1 never executed
    #####:  156:      return failure();
    #####:  157:    rewriter.replaceOpWithNewOp<SPIRVFMAOp>(fmaOp, dstType, adaptor.getLhs(),
call    0 never executed
call    1 never executed
    #####:  158:                                            adaptor.getRhs(), adaptor.getAcc());
call    0 never executed
call    1 never executed
    #####:  159:    return success();
        -:  160:  }
------------------
_ZNK12_GLOBAL__N_118VectorFmaOpConvertIN4mlir5spirv7CLFmaOpEE15matchAndRewriteENS1_6vector5FMAOpENS5_12FMAOpAdaptorERNS1_25ConversionPatternRewriterE:
function _ZNK12_GLOBAL__N_118VectorFmaOpConvertIN4mlir5spirv7CLFmaOpEE15matchAndRewriteENS1_6vector5FMAOpENS5_12FMAOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  152:  matchAndRewrite(vector::FMAOp fmaOp, OpAdaptor adaptor,
        -:  153:                  ConversionPatternRewriter &rewriter) const override {
    #####:  154:    Type dstType = getTypeConverter()->convertType(fmaOp.getType());
call    0 never executed
call    1 never executed
    #####:  155:    if (!dstType)
branch  0 never executed
branch  1 never executed
    #####:  156:      return failure();
    #####:  157:    rewriter.replaceOpWithNewOp<SPIRVFMAOp>(fmaOp, dstType, adaptor.getLhs(),
call    0 never executed
call    1 never executed
    #####:  158:                                            adaptor.getRhs(), adaptor.getAcc());
call    0 never executed
call    1 never executed
    #####:  159:    return success();
        -:  160:  }
------------------
        -:  161:};
        -:  162:
        -:  163:struct VectorInsertOpConvert final
        -:  164:    : public OpConversionPattern<vector::InsertOp> {
        -:  165:  using OpConversionPattern::OpConversionPattern;
        -:  166:
        -:  167:  LogicalResult
function _ZNK12_GLOBAL__N_121VectorInsertOpConvert15matchAndRewriteEN4mlir6vector8InsertOpENS2_15InsertOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  168:  matchAndRewrite(vector::InsertOp insertOp, OpAdaptor adaptor,
        -:  169:                  ConversionPatternRewriter &rewriter) const override {
        -:  170:    // Special case for inserting scalar values into size-1 vectors.
    #####:  171:    if (insertOp.getSourceType().isIntOrFloat() &&
call    0 never executed
call    1 never executed
branch  2 never executed
branch  3 never executed
branch  4 never executed
branch  5 never executed
    #####:  172:        insertOp.getDestVectorType().getNumElements() == 1) {
call    0 never executed
call    1 never executed
    #####:  173:      rewriter.replaceOp(insertOp, adaptor.getSource());
call    0 never executed
call    1 never executed
call    2 never executed
    #####:  174:      return success();
        -:  175:    }
        -:  176:
    #####:  177:    if (insertOp.getSourceType().isa<VectorType>() ||
call    0 never executed
call    1 never executed
branch  2 never executed
branch  3 never executed
branch  4 never executed
branch  5 never executed
    #####:  178:        !spirv::CompositeType::isValid(insertOp.getDestVectorType()))
call    0 never executed
call    1 never executed
    #####:  179:      return failure();
    #####:  180:    int32_t id = getFirstIntValue(insertOp.getPosition());
call    0 never executed
call    1 never executed
    #####:  181:    rewriter.replaceOpWithNewOp<spirv::CompositeInsertOp>(
    #####:  182:        insertOp, adaptor.getSource(), adaptor.getDest(), id);
call    0 never executed
call    1 never executed
call    2 never executed
    #####:  183:    return success();
        -:  184:  }
        -:  185:};
        -:  186:
        -:  187:struct VectorExtractElementOpConvert final
        -:  188:    : public OpConversionPattern<vector::ExtractElementOp> {
        -:  189:  using OpConversionPattern::OpConversionPattern;
        -:  190:
        -:  191:  LogicalResult
function _ZNK12_GLOBAL__N_129VectorExtractElementOpConvert15matchAndRewriteEN4mlir6vector16ExtractElementOpENS2_23ExtractElementOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  192:  matchAndRewrite(vector::ExtractElementOp extractOp, OpAdaptor adaptor,
        -:  193:                  ConversionPatternRewriter &rewriter) const override {
    #####:  194:    Type vectorType =
    #####:  195:        getTypeConverter()->convertType(adaptor.getVector().getType());
call    0 never executed
call    1 never executed
    #####:  196:    if (!vectorType)
branch  0 never executed
branch  1 never executed
    #####:  197:      return failure();
        -:  198:
    #####:  199:    if (vectorType.isa<spirv::ScalarType>()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  200:      rewriter.replaceOp(extractOp, adaptor.getVector());
call    0 never executed
call    1 never executed
call    2 never executed
    #####:  201:      return success();
        -:  202:    }
        -:  203:
    #####:  204:    rewriter.replaceOpWithNewOp<spirv::VectorExtractDynamicOp>(
    #####:  205:        extractOp, extractOp.getType(), adaptor.getVector(),
call    0 never executed
call    1 never executed
    #####:  206:        extractOp.getPosition());
call    0 never executed
call    1 never executed
    #####:  207:    return success();
        -:  208:  }
        -:  209:};
        -:  210:
        -:  211:struct VectorInsertElementOpConvert final
        -:  212:    : public OpConversionPattern<vector::InsertElementOp> {
        -:  213:  using OpConversionPattern::OpConversionPattern;
        -:  214:
        -:  215:  LogicalResult
function _ZNK12_GLOBAL__N_128VectorInsertElementOpConvert15matchAndRewriteEN4mlir6vector15InsertElementOpENS2_22InsertElementOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  216:  matchAndRewrite(vector::InsertElementOp insertOp, OpAdaptor adaptor,
        -:  217:                  ConversionPatternRewriter &rewriter) const override {
    #####:  218:    Type vectorType = getTypeConverter()->convertType(insertOp.getType());
call    0 never executed
call    1 never executed
    #####:  219:    if (!vectorType)
branch  0 never executed
branch  1 never executed
    #####:  220:      return failure();
        -:  221:
    #####:  222:    if (vectorType.isa<spirv::ScalarType>()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  223:      rewriter.replaceOp(insertOp, adaptor.getSource());
call    0 never executed
call    1 never executed
call    2 never executed
    #####:  224:      return success();
        -:  225:    }
        -:  226:
    #####:  227:    rewriter.replaceOpWithNewOp<spirv::VectorInsertDynamicOp>(
    #####:  228:        insertOp, vectorType, insertOp.getDest(), adaptor.getSource(),
call    0 never executed
call    1 never executed
    #####:  229:        insertOp.getPosition());
call    0 never executed
call    1 never executed
    #####:  230:    return success();
        -:  231:  }
        -:  232:};
        -:  233:
        -:  234:struct VectorInsertStridedSliceOpConvert final
        -:  235:    : public OpConversionPattern<vector::InsertStridedSliceOp> {
        -:  236:  using OpConversionPattern::OpConversionPattern;
        -:  237:
        -:  238:  LogicalResult
function _ZNK12_GLOBAL__N_133VectorInsertStridedSliceOpConvert15matchAndRewriteEN4mlir6vector20InsertStridedSliceOpENS2_27InsertStridedSliceOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  239:  matchAndRewrite(vector::InsertStridedSliceOp insertOp, OpAdaptor adaptor,
        -:  240:                  ConversionPatternRewriter &rewriter) const override {
    #####:  241:    Value srcVector = adaptor.getOperands().front();
call    0 never executed
call    1 never executed
    #####:  242:    Value dstVector = adaptor.getOperands().back();
call    0 never executed
call    1 never executed
        -:  243:
    #####:  244:    uint64_t stride = getFirstIntValue(insertOp.getStrides());
call    0 never executed
call    1 never executed
    #####:  245:    if (stride != 1)
branch  0 never executed
branch  1 never executed
    #####:  246:      return failure();
    #####:  247:    uint64_t offset = getFirstIntValue(insertOp.getOffsets());
call    0 never executed
call    1 never executed
        -:  248:
    #####:  249:    if (srcVector.getType().isa<spirv::ScalarType>()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  250:      assert(!dstVector.getType().isa<spirv::ScalarType>());
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
    #####:  251:      rewriter.replaceOpWithNewOp<spirv::CompositeInsertOp>(
    #####:  252:          insertOp, dstVector.getType(), srcVector, dstVector,
call    0 never executed
    #####:  253:          rewriter.getI32ArrayAttr(offset));
call    0 never executed
call    1 never executed
    #####:  254:      return success();
        -:  255:    }
        -:  256:
    #####:  257:    uint64_t totalSize =
    #####:  258:        dstVector.getType().cast<VectorType>().getNumElements();
call    0 never executed
call    1 never executed
    #####:  259:    uint64_t insertSize =
    #####:  260:        srcVector.getType().cast<VectorType>().getNumElements();
call    0 never executed
call    1 never executed
        -:  261:
    #####:  262:    SmallVector<int32_t, 2> indices(totalSize);
call    0 never executed
    #####:  263:    std::iota(indices.begin(), indices.end(), 0);
    #####:  264:    std::iota(indices.begin() + offset, indices.begin() + offset + insertSize,
        -:  265:              totalSize);
        -:  266:
    #####:  267:    rewriter.replaceOpWithNewOp<spirv::VectorShuffleOp>(
    #####:  268:        insertOp, dstVector.getType(), dstVector, srcVector,
call    0 never executed
    #####:  269:        rewriter.getI32ArrayAttr(indices));
call    0 never executed
call    1 never executed
        -:  270:
    #####:  271:    return success();
branch  0 never executed
branch  1 never executed
        -:  272:  }
        -:  273:};
        -:  274:
        -:  275:template <class SPIRVFMaxOp, class SPIRVFMinOp, class SPIRVUMaxOp,
        -:  276:          class SPIRVUMinOp, class SPIRVSMaxOp, class SPIRVSMinOp>
        -:  277:struct VectorReductionPattern final
        -:  278:    : public OpConversionPattern<vector::ReductionOp> {
        -:  279:  using OpConversionPattern::OpConversionPattern;
        -:  280:
        -:  281:  LogicalResult
    #####:  282:  matchAndRewrite(vector::ReductionOp reduceOp, OpAdaptor adaptor,
        -:  283:                  ConversionPatternRewriter &rewriter) const override {
    #####:  284:    Type resultType = typeConverter->convertType(reduceOp.getType());
    #####:  285:    if (!resultType)
    #####:  286:      return failure();
        -:  287:
    #####:  288:    auto srcVectorType = adaptor.getVector().getType().dyn_cast<VectorType>();
    #####:  289:    if (!srcVectorType || srcVectorType.getRank() != 1)
    #####:  290:      return rewriter.notifyMatchFailure(reduceOp, "not 1-D vector source");
        -:  291:
        -:  292:    // Extract all elements.
    #####:  293:    int numElements = srcVectorType.getDimSize(0);
    #####:  294:    SmallVector<Value, 4> values;
    #####:  295:    values.reserve(numElements + (adaptor.getAcc() != nullptr));
    #####:  296:    Location loc = reduceOp.getLoc();
    #####:  297:    for (int i = 0; i < numElements; ++i) {
    #####:  298:      values.push_back(rewriter.create<spirv::CompositeExtractOp>(
    #####:  299:          loc, srcVectorType.getElementType(), adaptor.getVector(),
    #####:  300:          rewriter.getI32ArrayAttr({i})));
        -:  301:    }
    #####:  302:    if (Value acc = adaptor.getAcc())
    #####:  303:      values.push_back(acc);
        -:  304:
        -:  305:    // Reduce them.
    #####:  306:    Value result = values.front();
    #####:  307:    for (Value next : llvm::makeArrayRef(values).drop_front()) {
    #####:  308:      switch (reduceOp.getKind()) {
        -:  309:
        -:  310:#define INT_AND_FLOAT_CASE(kind, iop, fop)                                     \
        -:  311:  case vector::CombiningKind::kind:                                            \
        -:  312:    if (resultType.isa<IntegerType>()) {                                       \
        -:  313:      result = rewriter.create<spirv::iop>(loc, resultType, result, next);     \
        -:  314:    } else {                                                                   \
        -:  315:      assert(resultType.isa<FloatType>());                                     \
        -:  316:      result = rewriter.create<spirv::fop>(loc, resultType, result, next);     \
        -:  317:    }                                                                          \
        -:  318:    break
        -:  319:
        -:  320:#define INT_OR_FLOAT_CASE(kind, fop)                                           \
        -:  321:  case vector::CombiningKind::kind:                                            \
        -:  322:    result = rewriter.create<fop>(loc, resultType, result, next);              \
        -:  323:    break
        -:  324:
    #####:  325:        INT_AND_FLOAT_CASE(ADD, IAddOp, FAddOp);
    #####:  326:        INT_AND_FLOAT_CASE(MUL, IMulOp, FMulOp);
        -:  327:
    #####:  328:        INT_OR_FLOAT_CASE(MAXF, SPIRVFMaxOp);
    #####:  329:        INT_OR_FLOAT_CASE(MINF, SPIRVFMinOp);
    #####:  330:        INT_OR_FLOAT_CASE(MINUI, SPIRVUMinOp);
    #####:  331:        INT_OR_FLOAT_CASE(MINSI, SPIRVSMinOp);
    #####:  332:        INT_OR_FLOAT_CASE(MAXUI, SPIRVUMaxOp);
    #####:  333:        INT_OR_FLOAT_CASE(MAXSI, SPIRVSMaxOp);
        -:  334:
    #####:  335:      case vector::CombiningKind::AND:
        -:  336:      case vector::CombiningKind::OR:
        -:  337:      case vector::CombiningKind::XOR:
    #####:  338:        return rewriter.notifyMatchFailure(reduceOp, "unimplemented");
        -:  339:      }
        -:  340:    }
        -:  341:
    #####:  342:    rewriter.replaceOp(reduceOp, result);
    #####:  343:    return success();
        -:  344:  }
------------------
_ZNK12_GLOBAL__N_122VectorReductionPatternIN4mlir5spirv8GLFMaxOpENS2_8GLFMinOpENS2_8GLUMaxOpENS2_8GLUMinOpENS2_8GLSMaxOpENS2_8GLSMinOpEE15matchAndRewriteENS1_6vector11ReductionOpENSA_18ReductionOpAdaptorERNS1_25ConversionPatternRewriterE:
function _ZNK12_GLOBAL__N_122VectorReductionPatternIN4mlir5spirv8GLFMaxOpENS2_8GLFMinOpENS2_8GLUMaxOpENS2_8GLUMinOpENS2_8GLSMaxOpENS2_8GLSMinOpEE15matchAndRewriteENS1_6vector11ReductionOpENSA_18ReductionOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  282:  matchAndRewrite(vector::ReductionOp reduceOp, OpAdaptor adaptor,
        -:  283:                  ConversionPatternRewriter &rewriter) const override {
    #####:  284:    Type resultType = typeConverter->convertType(reduceOp.getType());
call    0 never executed
    #####:  285:    if (!resultType)
branch  0 never executed
branch  1 never executed
    #####:  286:      return failure();
        -:  287:
    #####:  288:    auto srcVectorType = adaptor.getVector().getType().dyn_cast<VectorType>();
call    0 never executed
call    1 never executed
    #####:  289:    if (!srcVectorType || srcVectorType.getRank() != 1)
branch  0 never executed
branch  1 never executed
branch  2 never executed
branch  3 never executed
    #####:  290:      return rewriter.notifyMatchFailure(reduceOp, "not 1-D vector source");
call    0 never executed
        -:  291:
        -:  292:    // Extract all elements.
    #####:  293:    int numElements = srcVectorType.getDimSize(0);
call    0 never executed
call    1 never executed
    #####:  294:    SmallVector<Value, 4> values;
call    0 never executed
    #####:  295:    values.reserve(numElements + (adaptor.getAcc() != nullptr));
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  296:    Location loc = reduceOp.getLoc();
    #####:  297:    for (int i = 0; i < numElements; ++i) {
branch  0 never executed
branch  1 never executed
    #####:  298:      values.push_back(rewriter.create<spirv::CompositeExtractOp>(
call    0 never executed
call    1 never executed
    #####:  299:          loc, srcVectorType.getElementType(), adaptor.getVector(),
call    0 never executed
call    1 never executed
    #####:  300:          rewriter.getI32ArrayAttr({i})));
call    0 never executed
        -:  301:    }
    #####:  302:    if (Value acc = adaptor.getAcc())
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  303:      values.push_back(acc);
call    0 never executed
        -:  304:
        -:  305:    // Reduce them.
    #####:  306:    Value result = values.front();
call    0 never executed
    #####:  307:    for (Value next : llvm::makeArrayRef(values).drop_front()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  308:      switch (reduceOp.getKind()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
branch  3 never executed
branch  4 never executed
branch  5 never executed
branch  6 never executed
branch  7 never executed
branch  8 never executed
branch  9 never executed
branch 10 never executed
        -:  309:
        -:  310:#define INT_AND_FLOAT_CASE(kind, iop, fop)                                     \
        -:  311:  case vector::CombiningKind::kind:                                            \
        -:  312:    if (resultType.isa<IntegerType>()) {                                       \
        -:  313:      result = rewriter.create<spirv::iop>(loc, resultType, result, next);     \
        -:  314:    } else {                                                                   \
        -:  315:      assert(resultType.isa<FloatType>());                                     \
        -:  316:      result = rewriter.create<spirv::fop>(loc, resultType, result, next);     \
        -:  317:    }                                                                          \
        -:  318:    break
        -:  319:
        -:  320:#define INT_OR_FLOAT_CASE(kind, fop)                                           \
        -:  321:  case vector::CombiningKind::kind:                                            \
        -:  322:    result = rewriter.create<fop>(loc, resultType, result, next);              \
        -:  323:    break
        -:  324:
    #####:  325:        INT_AND_FLOAT_CASE(ADD, IAddOp, FAddOp);
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
call    6 never executed
call    7 never executed
    #####:  326:        INT_AND_FLOAT_CASE(MUL, IMulOp, FMulOp);
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
call    6 never executed
call    7 never executed
        -:  327:
    #####:  328:        INT_OR_FLOAT_CASE(MAXF, SPIRVFMaxOp);
call    0 never executed
    #####:  329:        INT_OR_FLOAT_CASE(MINF, SPIRVFMinOp);
call    0 never executed
    #####:  330:        INT_OR_FLOAT_CASE(MINUI, SPIRVUMinOp);
call    0 never executed
    #####:  331:        INT_OR_FLOAT_CASE(MINSI, SPIRVSMinOp);
call    0 never executed
    #####:  332:        INT_OR_FLOAT_CASE(MAXUI, SPIRVUMaxOp);
call    0 never executed
    #####:  333:        INT_OR_FLOAT_CASE(MAXSI, SPIRVSMaxOp);
call    0 never executed
        -:  334:
    #####:  335:      case vector::CombiningKind::AND:
        -:  336:      case vector::CombiningKind::OR:
        -:  337:      case vector::CombiningKind::XOR:
    #####:  338:        return rewriter.notifyMatchFailure(reduceOp, "unimplemented");
call    0 never executed
        -:  339:      }
        -:  340:    }
        -:  341:
    #####:  342:    rewriter.replaceOp(reduceOp, result);
call    0 never executed
    #####:  343:    return success();
branch  0 never executed
branch  1 never executed
        -:  344:  }
------------------
_ZNK12_GLOBAL__N_122VectorReductionPatternIN4mlir5spirv8CLFMaxOpENS2_8CLFMinOpENS2_8CLUMaxOpENS2_8CLUMinOpENS2_8CLSMaxOpENS2_8CLSMinOpEE15matchAndRewriteENS1_6vector11ReductionOpENSA_18ReductionOpAdaptorERNS1_25ConversionPatternRewriterE:
function _ZNK12_GLOBAL__N_122VectorReductionPatternIN4mlir5spirv8CLFMaxOpENS2_8CLFMinOpENS2_8CLUMaxOpENS2_8CLUMinOpENS2_8CLSMaxOpENS2_8CLSMinOpEE15matchAndRewriteENS1_6vector11ReductionOpENSA_18ReductionOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  282:  matchAndRewrite(vector::ReductionOp reduceOp, OpAdaptor adaptor,
        -:  283:                  ConversionPatternRewriter &rewriter) const override {
    #####:  284:    Type resultType = typeConverter->convertType(reduceOp.getType());
call    0 never executed
    #####:  285:    if (!resultType)
branch  0 never executed
branch  1 never executed
    #####:  286:      return failure();
        -:  287:
    #####:  288:    auto srcVectorType = adaptor.getVector().getType().dyn_cast<VectorType>();
call    0 never executed
call    1 never executed
    #####:  289:    if (!srcVectorType || srcVectorType.getRank() != 1)
branch  0 never executed
branch  1 never executed
branch  2 never executed
branch  3 never executed
    #####:  290:      return rewriter.notifyMatchFailure(reduceOp, "not 1-D vector source");
call    0 never executed
        -:  291:
        -:  292:    // Extract all elements.
    #####:  293:    int numElements = srcVectorType.getDimSize(0);
call    0 never executed
call    1 never executed
    #####:  294:    SmallVector<Value, 4> values;
call    0 never executed
    #####:  295:    values.reserve(numElements + (adaptor.getAcc() != nullptr));
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  296:    Location loc = reduceOp.getLoc();
    #####:  297:    for (int i = 0; i < numElements; ++i) {
branch  0 never executed
branch  1 never executed
    #####:  298:      values.push_back(rewriter.create<spirv::CompositeExtractOp>(
call    0 never executed
call    1 never executed
    #####:  299:          loc, srcVectorType.getElementType(), adaptor.getVector(),
call    0 never executed
call    1 never executed
    #####:  300:          rewriter.getI32ArrayAttr({i})));
call    0 never executed
        -:  301:    }
    #####:  302:    if (Value acc = adaptor.getAcc())
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  303:      values.push_back(acc);
call    0 never executed
        -:  304:
        -:  305:    // Reduce them.
    #####:  306:    Value result = values.front();
call    0 never executed
    #####:  307:    for (Value next : llvm::makeArrayRef(values).drop_front()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  308:      switch (reduceOp.getKind()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
branch  3 never executed
branch  4 never executed
branch  5 never executed
branch  6 never executed
branch  7 never executed
branch  8 never executed
branch  9 never executed
branch 10 never executed
        -:  309:
        -:  310:#define INT_AND_FLOAT_CASE(kind, iop, fop)                                     \
        -:  311:  case vector::CombiningKind::kind:                                            \
        -:  312:    if (resultType.isa<IntegerType>()) {                                       \
        -:  313:      result = rewriter.create<spirv::iop>(loc, resultType, result, next);     \
        -:  314:    } else {                                                                   \
        -:  315:      assert(resultType.isa<FloatType>());                                     \
        -:  316:      result = rewriter.create<spirv::fop>(loc, resultType, result, next);     \
        -:  317:    }                                                                          \
        -:  318:    break
        -:  319:
        -:  320:#define INT_OR_FLOAT_CASE(kind, fop)                                           \
        -:  321:  case vector::CombiningKind::kind:                                            \
        -:  322:    result = rewriter.create<fop>(loc, resultType, result, next);              \
        -:  323:    break
        -:  324:
    #####:  325:        INT_AND_FLOAT_CASE(ADD, IAddOp, FAddOp);
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
call    6 never executed
call    7 never executed
    #####:  326:        INT_AND_FLOAT_CASE(MUL, IMulOp, FMulOp);
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
call    6 never executed
call    7 never executed
        -:  327:
    #####:  328:        INT_OR_FLOAT_CASE(MAXF, SPIRVFMaxOp);
call    0 never executed
    #####:  329:        INT_OR_FLOAT_CASE(MINF, SPIRVFMinOp);
call    0 never executed
    #####:  330:        INT_OR_FLOAT_CASE(MINUI, SPIRVUMinOp);
call    0 never executed
    #####:  331:        INT_OR_FLOAT_CASE(MINSI, SPIRVSMinOp);
call    0 never executed
    #####:  332:        INT_OR_FLOAT_CASE(MAXUI, SPIRVUMaxOp);
call    0 never executed
    #####:  333:        INT_OR_FLOAT_CASE(MAXSI, SPIRVSMaxOp);
call    0 never executed
        -:  334:
    #####:  335:      case vector::CombiningKind::AND:
        -:  336:      case vector::CombiningKind::OR:
        -:  337:      case vector::CombiningKind::XOR:
    #####:  338:        return rewriter.notifyMatchFailure(reduceOp, "unimplemented");
call    0 never executed
        -:  339:      }
        -:  340:    }
        -:  341:
    #####:  342:    rewriter.replaceOp(reduceOp, result);
call    0 never executed
    #####:  343:    return success();
branch  0 never executed
branch  1 never executed
        -:  344:  }
------------------
        -:  345:};
        -:  346:
        -:  347:class VectorSplatPattern final : public OpConversionPattern<vector::SplatOp> {
        -:  348:public:
        -:  349:  using OpConversionPattern<vector::SplatOp>::OpConversionPattern;
        -:  350:
        -:  351:  LogicalResult
function _ZNK12_GLOBAL__N_118VectorSplatPattern15matchAndRewriteEN4mlir6vector7SplatOpENS2_14SplatOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  352:  matchAndRewrite(vector::SplatOp op, OpAdaptor adaptor,
        -:  353:                  ConversionPatternRewriter &rewriter) const override {
    #####:  354:    Type dstType = getTypeConverter()->convertType(op.getType());
call    0 never executed
call    1 never executed
    #####:  355:    if (!dstType)
branch  0 never executed
branch  1 never executed
    #####:  356:      return failure();
    #####:  357:    if (dstType.isa<spirv::ScalarType>()) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  358:      rewriter.replaceOp(op, adaptor.getInput());
call    0 never executed
call    1 never executed
call    2 never executed
        -:  359:    } else {
    #####:  360:      auto dstVecType = dstType.cast<VectorType>();
call    0 never executed
    #####:  361:      SmallVector<Value, 4> source(dstVecType.getNumElements(),
call    0 never executed
    #####:  362:                                   adaptor.getInput());
call    0 never executed
call    1 never executed
    #####:  363:      rewriter.replaceOpWithNewOp<spirv::CompositeConstructOp>(op, dstType,
    #####:  364:                                                               source);
call    0 never executed
branch  1 never executed
branch  2 never executed
        -:  365:    }
    #####:  366:    return success();
        -:  367:  }
        -:  368:};
        -:  369:
        -:  370:struct VectorShuffleOpConvert final
        -:  371:    : public OpConversionPattern<vector::ShuffleOp> {
        -:  372:  using OpConversionPattern::OpConversionPattern;
        -:  373:
        -:  374:  LogicalResult
function _ZNK12_GLOBAL__N_122VectorShuffleOpConvert15matchAndRewriteEN4mlir6vector9ShuffleOpENS2_16ShuffleOpAdaptorERNS1_25ConversionPatternRewriterE called 0 returned 0% blocks executed 0%
    #####:  375:  matchAndRewrite(vector::ShuffleOp shuffleOp, OpAdaptor adaptor,
        -:  376:                  ConversionPatternRewriter &rewriter) const override {
    #####:  377:    auto oldResultType = shuffleOp.getVectorType();
call    0 never executed
    #####:  378:    if (!spirv::CompositeType::isValid(oldResultType))
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  379:      return failure();
    #####:  380:    Type newResultType = getTypeConverter()->convertType(oldResultType);
call    0 never executed
        -:  381:
    #####:  382:    auto oldSourceType = shuffleOp.getV1VectorType();
call    0 never executed
    #####:  383:    if (oldSourceType.getNumElements() > 1) {
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  384:      SmallVector<int32_t, 4> components = llvm::to_vector<4>(
function _ZZNK12_GLOBAL__N_122VectorShuffleOpConvert15matchAndRewriteEN4mlir6vector9ShuffleOpENS2_16ShuffleOpAdaptorERNS1_25ConversionPatternRewriterEENKUlNS1_9AttributeEE_clES7_.isra.0 called 0 returned 0% blocks executed 0%
    #####:  385:          llvm::map_range(shuffleOp.getMask(), [](Attribute attr) -> int32_t {
call    0 never executed
    #####:  386:            return attr.cast<IntegerAttr>().getValue().getZExtValue();
call    0 never executed
call    1 never executed
call    2 never executed
branch  3 never executed
branch  4 never executed
    #####:  387:          }));
call    0 never executed
call    1 never executed
    #####:  388:      rewriter.replaceOpWithNewOp<spirv::VectorShuffleOp>(
    #####:  389:          shuffleOp, newResultType, adaptor.getV1(), adaptor.getV2(),
call    0 never executed
call    1 never executed
    #####:  390:          rewriter.getI32ArrayAttr(components));
call    0 never executed
call    1 never executed
    #####:  391:      return success();
branch  0 never executed
branch  1 never executed
        -:  392:    }
        -:  393:
    #####:  394:    SmallVector<Value, 2> oldOperands = {adaptor.getV1(), adaptor.getV2()};
call    0 never executed
call    1 never executed
call    2 never executed
    #####:  395:    SmallVector<Value, 4> newOperands;
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  396:    newOperands.reserve(oldResultType.getNumElements());
call    0 never executed
branch  1 never executed
branch  2 never executed
    #####:  397:    for (const APInt &i : shuffleOp.getMask().getAsValueRange<IntegerAttr>()) {
call    0 never executed
call    1 never executed
branch  2 never executed
branch  3 never executed
call    4 never executed
    #####:  398:      newOperands.push_back(oldOperands[i.getZExtValue()]);
call    0 never executed
branch  1 never executed
branch  2 never executed
call    3 never executed
branch  4 never executed
branch  5 never executed
        -:  399:    }
    #####:  400:    rewriter.replaceOpWithNewOp<spirv::CompositeConstructOp>(
    #####:  401:        shuffleOp, newResultType, newOperands);
call    0 never executed
        -:  402:
    #####:  403:    return success();
branch  0 never executed
branch  1 never executed
        -:  404:  }
        -:  405:};
        -:  406:
        -:  407:} // namespace
        -:  408:#define CL_MAX_MIN_OPS                                                         \
        -:  409:  spirv::CLFMaxOp, spirv::CLFMinOp, spirv::CLUMaxOp, spirv::CLUMinOp,          \
        -:  410:      spirv::CLSMaxOp, spirv::CLSMinOp
        -:  411:
        -:  412:#define GL_MAX_MIN_OPS                                                         \
        -:  413:  spirv::GLFMaxOp, spirv::GLFMinOp, spirv::GLUMaxOp, spirv::GLUMinOp,          \
        -:  414:      spirv::GLSMaxOp, spirv::GLSMinOp
        -:  415:
function _ZN4mlir29populateVectorToSPIRVPatternsERNS_18SPIRVTypeConverterERNS_17RewritePatternSetE called 880 returned 100% blocks executed 100%
      880:  416:void mlir::populateVectorToSPIRVPatterns(SPIRVTypeConverter &typeConverter,
        -:  417:                                         RewritePatternSet &patterns) {
      880:  418:  patterns.add<
        -:  419:      VectorBitcastConvert, VectorBroadcastConvert,
        -:  420:      VectorExtractElementOpConvert, VectorExtractOpConvert,
        -:  421:      VectorExtractStridedSliceOpConvert, VectorFmaOpConvert<spirv::GLFmaOp>,
        -:  422:      VectorFmaOpConvert<spirv::CLFmaOp>, VectorInsertElementOpConvert,
        -:  423:      VectorInsertOpConvert, VectorReductionPattern<GL_MAX_MIN_OPS>,
        -:  424:      VectorReductionPattern<CL_MAX_MIN_OPS>, VectorInsertStridedSliceOpConvert,
        -:  425:      VectorShuffleOpConvert, VectorSplatPattern>(typeConverter,
      880:  426:                                                  patterns.getContext());
call    0 returned 100%
      880:  427:}
